<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#0f111a" />
  <meta name="description" content="Estrattore di intervalli e toniche per esercizi musicali" />
  <link rel="icon" href="icon.png" />
  <link rel="manifest" href="manifest.json" />
  <title>Tavola degli intervalli</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: #0f111a;
      color: #ffffff;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }

    .page-header {
      width: 100vw;
      background-color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      box-sizing: border-box;
      flex-wrap: wrap;
    }

    .logo {
      height: 60px;
      object-fit: contain;
    }

    .speaker-icon {
      height: 40px;
      cursor: pointer;
    }

    .page-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #0f111a;
      text-align: center;
      flex: 1;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 30px;
      padding: 20px;
    }

    button {
      background-color: #5c5eff;
      border: none;
      color: #fff;
      padding: 20px 50px;
      font-size: 1.5rem;
      border-radius: 12px;
      cursor: pointer;
      transition: background-color 0.2s ease, transform 0.1s ease;
      font-family: Arial, sans-serif;
    }

    button:hover {
      background-color: #7b7dff;
    }

    .fullscreen-button {
      background-color: #2e323d;
      color: #fff;
      padding: 12px 24px;
      font-size: 1.2rem;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-family: Arial, sans-serif;
    }

    .fullscreen-button:hover {
      background-color: #3e4455;
    }

    .output {
      font-size: 11rem;
      padding: 50px;
      border-radius: 16px;
      background-color: #1a1c25;
      min-width: 300px;
      text-align: center;
      opacity: 0;
      transform: scale(0.7);
      transition: all 0.3s ease-in-out;
      font-family: Arial, sans-serif;
    }

    .output.show {
      opacity: 1;
      transform: scale(1);
      animation: blinkFade 0.4s ease;
    }

    .output.audio-active {
      box-shadow: 0 0 25px 8px #5c5eff;
      transition: box-shadow 0.3s ease;
    }

    @keyframes blinkFade {
      0% { background-color: #1a1c25; }
      25% { background-color: #2a2d38; }
      50% { background-color: #3a3e4d; }
      75% { background-color: #2a2d38; }
      100% { background-color: #1a1c25; }
    }

    .top-controls {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
    }

    select {
      padding: 12px 24px;
      font-size: 1.2rem;
      background-color: #2a2e3d;
      color: #fff;
      border: none;
      border-radius: 10px;
      font-family: Arial, sans-serif;
    }

    .bpm-control {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .bpm-control button {
      background-color: #2a2e3d;
      color: #fff;
      padding: 10px 16px;
      font-size: 1.2rem;
      border-radius: 8px;
      border: none;
      font-family: Arial, sans-serif;
    }

    .bpm-control button:hover {
      background-color: #3e4455;
    }

    .bpm-display {
      font-size: 1.2rem;
      min-width: 60px;
      text-align: center;
      font-family: Arial, sans-serif;
    }

    .tempo-button {
      background-color: #2e323d;
      padding: 4px 14px;
      font-size: 0.8rem;
      border-radius: 12px;
      color: #fff;
      border: none;
      cursor: pointer;
      font-family: Arial, sans-serif;
      margin-top: 10px;
      margin-bottom: 10px;
    }

    .tempo-button.active {
      background-color: #5c5eff;
    }

    .tempo-button:hover {
      background-color: #7b7dff;
    }

    @media (max-width: 768px) {
      .output {
        font-size: 6rem;
      }
      .logo {
        height: 40px;
      }
      .speaker-icon {
        height: 30px;
      }
    }

    @media (max-width: 480px) {
      .output {
        font-size: 3rem;
      }
      button, select {
        font-size: 1rem;
        padding: 10px 16px;
      }
    }
  </style>
</head>
<body>
  <div class="page-header">
    <img src="./VSA.png" alt="Logo VSA" class="logo">
    <div class="page-title">Tavola degli intervalli</div>
    <img src="./Speaker_off.svg" id="speaker-icon" alt="Speaker" class="speaker-icon" onclick="toggleSpeaker()">
  </div>
  <main>
    <div class="top-controls">
      <select id="lista">
        <option value="naturali">Intervalli Naturali</option>
        <option value="armonici">Intervalli Naturali e Alterati</option>
        <option value="toniche">Toniche</option>
      </select>
      <button class="fullscreen-button" onclick="toggleFullscreen()">Full screen</button>
    </div>

    <div class="output" id="output"></div>

    <button onclick="estraiElemento()">Chiedimi</button>

    <div class="bpm-control">
      <button onclick="modificaBPM(-1)">-</button>
      <span class="bpm-display" id="bpm">20 bpm</span>
      <button onclick="modificaBPM(1)">+</button>
      <button class="tempo-button" id="tempo-btn" onclick="toggleTempo()">Chiedimi a tempo</button>
    </div>
  </main>

  <script>
    let speakerOn = false;
    let bpm = 20;
    let timer = null;
    let audioPlayer = null;
    // Sblocco audio per iOS
window.addEventListener("touchstart", () => {
  const unlock = new Audio();
  unlock.play().then(() => unlock.pause());
}, { once: true });


    const fileMap = {
      "ğŸ·": "1.ogg", "ğŸ¸": "2.ogg", "ğŸ¹": "3.ogg", "ğŸº": "4.ogg", "ğŸ»": "5.ogg", "ğŸ¼": "6.ogg", "ğŸ½": "7.ogg", "ğŸ¾": "8.ogg", "ğŸ¿": "9.ogg",
      "ğŸ·ğŸ·": "11.ogg", "ğŸ·ğŸ¹": "13.ogg", "ğŸ¸#": "2sharp.ogg", "ğŸ¸ğš‹": "2b.ogg", "ğŸ¹ğš‹": "3b.ogg", "ğŸº#": "4sharp.ogg", "ğŸ»ğš‹": "5b.ogg",
      "ğŸ»#": "5sharp.ogg", "ğŸ¼ğš‹": "6b.ogg", "ğŸ¼#": "6sharp.ogg", "ğŸ½ğš‹": "7b.ogg", "ğŸ·ğŸ¹ğš‹": "13b.ogg", "ğŸ·ğŸ¹#": "13sharp.ogg",
      "ğŸ¿ğš‹": "9b.ogg", "ğŸ·ğŸ·#": "11sharp.ogg", "ğŸ¿#": "9sharp.ogg",
      "ğ™²": "C.ogg", "ğ™³â™­": "Db.ogg", "ğ™³": "D.ogg", "ğ™´â™­": "Eb.ogg", "ğ™´": "E.ogg", "ğ™µ": "F.ogg",
      "ğ™¶â™­": "Gb.ogg", "ğ™¶": "G.ogg", "ğ™°â™­": "Ab.ogg", "ğ™°": "A.ogg", "ğ™±â™­": "Bb.ogg", "ğ™±": "b.ogg"
    };
    const tempoBtn = document.getElementById("tempo-btn");
    const history = {
      naturali: [],
      armonici: [],
      toniche: []
    };

    function toggleSpeaker() {
      const icon = document.getElementById("speaker-icon");
      speakerOn = !speakerOn;
      icon.src = speakerOn ? "./Speaker_on.svg" : "./Speaker_off.svg";
    }

    function estraiElemento() {
      const output = document.getElementById("output");
      output.classList.remove("show", "audio-active");
      void output.offsetWidth;

      const lista = document.getElementById("lista").value;
      const elementi = {
        naturali: ["ğŸ·", "ğŸ¸", "ğŸ¹", "ğŸº", "ğŸ»", "ğŸ¼", "ğŸ½", "ğŸ¾", "ğŸ¿", "ğŸ·ğŸ·", "ğŸ·ğŸ¹"],
        armonici: ["ğŸ·", "ğŸ¸", "ğŸ¹", "ğŸº", "ğŸ»", "ğŸ¼", "ğŸ½", "ğŸ¾", "ğŸ¿", "ğŸ·ğŸ·", "ğŸ·ğŸ¹", "ğŸ¸#", "ğŸ¸ğš‹", "ğŸ¹ğš‹", "ğŸº#", "ğŸ»ğš‹", "ğŸ»#", "ğŸ¼ğš‹", "ğŸ¼#", "ğŸ½ğš‹", "ğŸ·ğŸ¹ğš‹", "ğŸ·ğŸ¹#", "ğŸ¿ğš‹", "ğŸ·ğŸ·#", "ğŸ¿#"],
        toniche: ["ğ™²", "ğ™³â™­", "ğ™³", "ğ™´â™­", "ğ™´", "ğ™µ", "ğ™¶â™­", "ğ™¶", "ğ™°â™­", "ğ™°", "ğ™±â™­", "ğ™±"]
      };

      if (history[lista].length === elementi[lista].length) {
        history[lista] = [];
      }

      let estratto;
      do {
        estratto = elementi[lista][Math.floor(Math.random() * elementi[lista].length)];
      } while (history[lista].includes(estratto));

      history[lista].push(estratto);

      output.textContent = estratto;
      output.classList.add("show");

      if (speakerOn) {
        output.classList.add("audio-active");
        if (audioPlayer) {
          audioPlayer.pause();
          audioPlayer.currentTime = 0;
        }
        const fileName = fileMap[estratto] || `${estratto}.ogg`;
        audioPlayer = new Audio(`audio/${fileName}`);
        audioPlayer.play();
      }
    }

    function modificaBPM(delta) {
      bpm = Math.max(10, bpm + delta);
      document.getElementById("bpm").textContent = `${bpm} bpm`;
      if (timer !== null) {
        clearInterval(timer);
        timer = setInterval(estraiElemento, 60000 / bpm);
      }
    }

    function toggleTempo() {
      if (timer === null) {
        timer = setInterval(estraiElemento, 60000 / bpm);
        tempoBtn.classList.add("active");
      } else {
        clearInterval(timer);
        timer = null;
        tempoBtn.classList.remove("active");
      }
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        }
      }
    }
  </script>
</body>
</html>
